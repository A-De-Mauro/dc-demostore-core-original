"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DynamicContent = void 0;
var HalClient_1 = require("./hal/services/HalClient");
var AxiosHttpClient_1 = require("./http/AxiosHttpClient");
var ContentItem_1 = require("./model/ContentItem");
var ContentRepository_1 = require("./model/ContentRepository");
var ContentType_1 = require("./model/ContentType");
var ContentTypeSchema_1 = require("./model/ContentTypeSchema");
var Edition_1 = require("./model/Edition");
var Event_1 = require("./model/Event");
var Folder_1 = require("./model/Folder");
var Hub_1 = require("./model/Hub");
var Snapshot_1 = require("./model/Snapshot");
var OAuth2Client_1 = require("./oauth2/services/OAuth2Client");
var HierarchyParents_1 = require("./model/HierarchyParents");
var HierarchyChildren_1 = require("./model/HierarchyChildren");
var WorkflowState_1 = require("./model/WorkflowState");
var Extension_1 = require("./model/Extension");
/**
 * Amplience Dynamic Content API client.
 *
 * Your application should avoid where possible creating a new client for each request.
 * Authentication tokens are cached by the client and only re-requested when
 * they expire, allowing performance to be improved by reusing the client across requests.
 *
 * If multiple sets of credentials are required your application should create one client
 * per credential set.
 *
 * Example:
 *
 * ```typescript
 * const client = new DynamicContent({
 *    client_id: process.env.CLIENT_ID,
 *    client_secret: process.env.CLIENT_SECRET
 * });
 *
 * const repository = await client.contentRepositories.get('<REPO-ID>');
 *
 * const contentItem = new ContentItem();
 * contentItem.label = 'Homepage Article';
 * contentItem.body = {
 *      _meta: {
 *          schema: "https://github.com/techiedarren/dc-examples/blob/master/content-types/blocks/text-block.json"
 *      },
 *      paragraphs: [
 *          "Example article text..."
 *      ]
 * };
 *
 * await repository.related.contentItems.create(contentItem);
 * ```
 */
var DynamicContent = /** @class */ (function () {
    /**
     * Creates a Dynamic Content API client instance. You must provide credentials that will
     * be used to authenticate with the API.
     *
     * @param clientCredentials Api credentials used to generate an authentication token
     * @param dcConfig Optional configuration settings for Dynamic Content
     * @param httpClient Optional request settings, can be used to provide proxy settings, add interceptors etc
     */
    function DynamicContent(clientCredentials, dcConfig, httpClient) {
        var _this = this;
        /**
         * Hub Resources
         */
        this.hubs = {
            /**
             * Retrieve a hub resource by id
             * @param id hub id, previously generated on creation
             */
            get: function (id) {
                return _this.client.fetchResource("/hubs/" + id, Hub_1.Hub);
            },
            /**
             * Retrieve a list of hub resources shared with your client credentials.
             * @param options Pagination options
             */
            list: function (options) {
                return _this.client.fetchLinkedResource({ href: '/hubs{?page,size}', templated: true }, options, Hub_1.HubsPage);
            },
        };
        this.contentTypeSchemas = {
            /**
             * Gets a content type schemas
             * @param id ContentTypeSchema id
             */
            get: function (id) {
                return _this.client.fetchResource("/content-type-schemas/" + id, ContentTypeSchema_1.ContentTypeSchema);
            },
            /**
             * Gets a content type schemas
             * @param id ContentTypeSchema id
             * @param version Version
             */
            getByVersion: function (id, version) {
                return _this.client.fetchResource("/content-type-schemas/" + id + "/" + version, ContentTypeSchema_1.ContentTypeSchema);
            },
        };
        /**
         * Content Repository Resources
         */
        this.contentRepositories = {
            /**
             * Retrieve a content repository resource by id
             * @param id content repository id, previously generated on creation
             */
            get: function (id) {
                return _this.client.fetchResource("/content-repositories/" + id, ContentRepository_1.ContentRepository);
            },
        };
        /**
         * Hierarchy Resources
         */
        this.hierarchies = {
            parents: {
                /**
                 * Retrieve parents of the associated content item
                 * @param id content item id accociated content item
                 */
                get: function (id) {
                    return _this.client.fetchResource("/hierarchy-node/" + id + "/parents", HierarchyParents_1.HierarchyParents);
                },
            },
            children: {
                /**
                 * Retrieve children of the associated content item
                 * @param id content item id accociated content item
                 */
                get: function (id) {
                    return _this.client.fetchResource("/hierarchy-node/" + id + "/children", HierarchyChildren_1.HierarchyChildren);
                },
            },
        };
        /**
         * Content Item Resources
         */
        this.contentItems = {
            /**
             * Retrieve a content item resource by id
             * @param id content item id, previously generated on creation
             */
            get: function (id) {
                return _this.client.fetchResource("/content-items/" + id, ContentItem_1.ContentItem);
            },
        };
        /**
         * Content Type Resources
         */
        this.contentTypes = {
            /**
             * Retrieve a content type resource by id
             * @param id content type id, previously generated on creation
             */
            get: function (id) {
                return _this.client.fetchResource("/content-types/" + id, ContentType_1.ContentType);
            },
        };
        this.folders = {
            /**
             * Retrieve a folder resource by id
             * @param id folder id, previously generated on creation
             */
            get: function (id) {
                return _this.client.fetchResource("/folders/" + id, Folder_1.Folder);
            },
        };
        /**
         * Snapshot Resources
         */
        this.snapshots = {
            /**
             * Retrieve a snapshot resource by id
             * @param id snapshot id, previously generated on creation
             */
            get: function (id) {
                return _this.client.fetchResource("/snapshots/" + id, Snapshot_1.Snapshot);
            },
        };
        /**
         * Event Resources
         */
        this.events = {
            /**
             * Retrieve an event resource by id
             * @param id event id, previously generated on creation
             */
            get: function (id) {
                return _this.client.fetchResource("/events/" + id, Event_1.Event);
            },
        };
        /**
         * Edition Resources
         */
        this.editions = {
            /**
             * Retrieve an edition resource by id
             * @param id edition id, previously generated on creation
             */
            get: function (id) {
                return _this.client.fetchResource("/editions/" + id, Edition_1.Edition);
            },
        };
        /**
         * Extension Resources
         */
        this.extensions = {
            /**
             * Retrieve an extension resource by id
             * @param id extension id, previously generated on creation
             */
            get: function (id) {
                return _this.client.fetchResource("/extensions/" + id, Extension_1.Extension);
            },
        };
        /**
         * Workflow States
         */
        this.workflowStates = {
            /**
             * Retrieve a Workflow State by id
             * @param id of Workflow State, previously generated on creation
             */
            get: function (id) {
                return _this.client.fetchResource("/workflow-states/" + id, WorkflowState_1.WorkflowState);
            },
        };
        dcConfig = dcConfig || {};
        dcConfig.apiUrl = dcConfig.apiUrl || 'https://api.amplience.net/v2/content';
        dcConfig.authUrl = dcConfig.authUrl || 'https://auth.amplience.net';
        var httpClientInstance;
        if (httpClient !== undefined && 'request' in httpClient) {
            httpClientInstance = httpClient;
        }
        else {
            httpClientInstance = new AxiosHttpClient_1.AxiosHttpClient(httpClient === undefined ? {} : httpClient);
        }
        var tokenClient = this.createTokenClient(dcConfig, clientCredentials, httpClientInstance);
        this.client = this.createResourceClient(dcConfig, tokenClient, httpClientInstance);
    }
    DynamicContent.prototype.createTokenClient = function (dcConfig, clientCredentials, httpClient) {
        return new OAuth2Client_1.OAuth2Client(clientCredentials, {
            authUrl: dcConfig.authUrl,
        }, httpClient);
    };
    DynamicContent.prototype.createResourceClient = function (dcConfig, tokenProvider, httpClient) {
        return new HalClient_1.DefaultHalClient(dcConfig.apiUrl, httpClient, tokenProvider);
    };
    return DynamicContent;
}());
exports.DynamicContent = DynamicContent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRHluYW1pY0NvbnRlbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvbGliL0R5bmFtaWNDb250ZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUNBLHNEQUF1RTtBQUN2RSwwREFBeUQ7QUFFekQsbURBQWtEO0FBQ2xELCtEQUE4RDtBQUM5RCxtREFBa0Q7QUFDbEQsK0RBQThEO0FBQzlELDJDQUEwQztBQUMxQyx1Q0FBc0M7QUFDdEMseUNBQXdDO0FBQ3hDLG1DQUE0QztBQUc1Qyw2Q0FBNEM7QUFHNUMsK0RBQThEO0FBQzlELDZEQUE0RDtBQUM1RCwrREFBOEQ7QUFDOUQsdURBQXNEO0FBQ3RELCtDQUE4QztBQW9COUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztHQWlDRztBQUNIO0lBNExFOzs7Ozs7O09BT0c7SUFDSCx3QkFDRSxpQkFBbUQsRUFDbkQsUUFBK0IsRUFDL0IsVUFBNEM7UUFIOUMsaUJBNkJDO1FBaE9EOztXQUVHO1FBQ2EsU0FBSSxHQUFHO1lBQ3JCOzs7ZUFHRztZQUNILEdBQUcsRUFBRSxVQUFDLEVBQVU7Z0JBQ2QsT0FBQSxLQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxXQUFTLEVBQUksRUFBRSxTQUFHLENBQUM7WUFBN0MsQ0FBNkM7WUFFL0M7OztlQUdHO1lBQ0gsSUFBSSxFQUFFLFVBQUMsT0FBa0I7Z0JBQ3ZCLE9BQUEsS0FBSSxDQUFDLE1BQU0sQ0FBQyxtQkFBbUIsQ0FDN0IsRUFBRSxJQUFJLEVBQUUsbUJBQW1CLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxFQUM5QyxPQUFPLEVBQ1AsY0FBUSxDQUNUO1lBSkQsQ0FJQztTQUNKLENBQUM7UUFFYyx1QkFBa0IsR0FBRztZQUNuQzs7O2VBR0c7WUFDSCxHQUFHLEVBQUUsVUFBQyxFQUFVO2dCQUNkLE9BQUEsS0FBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQ3ZCLDJCQUF5QixFQUFJLEVBQzdCLHFDQUFp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